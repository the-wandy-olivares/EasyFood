{% extends "food/base/base.html" %}
{% block content %}
{% load humanize %}
      <style>
            .detail-profile p
            {
                  margin: 0;
            }
            .my-profile {
                  background-color: var(--bg-primary) !important;
                  color:  #857f94 !important;
                  transform: scale(1.1);
            }
            .my-profile svg   {
                  display: none;
            }
      </style>
                  <a href="{% url "company:admin-company" %}"  class='esc d-none btn position-absolute  end-0 border-0  rounded-5 top-0 mt-5   p-2 pe-4 ps-4' style=" 
                      margin-right: 14rem;" >
                              <span style='font-weight:bold;' class='text-white' > Atras </span>
                  </a>
            
            <section class="d-flex">
                  <div data-aos='fade-in' class=' d-flex justify-content-center flex-wrap position-relative' style='width: 10rem; transition-delay: 0.2s  ;'>
                        <div style='width: 120px; height: 120px; background-color: var(--bg-primary); 
                        border-radius: 50%; border: 4px solid #7e7e7e; cursor: pointer; '
                              class="d-flex flex-wrap align-content-center img-load  mt-2 justify-content-center mb-1" >
                              {% if company.img %}
                                    <img src="{{company.img.url}}" class='w-100 h-100 object-fit-cover rounded-circle' alt="">
                              {% endif %}
                        </div>
                        {% if request.user.employee_profile.role == 'representante' %}
                        <!--Editar empresa-->
                        <a href="{% url "company:update-company"  company.id %}" class='btn d-flex position-absolute z-3 text-white-50 start-0 top-0 mb-1 me-3 bg-transparent border-0'
                              style='font-weight: bold; margin-top: 0rem; margin-left: 6.5rem; font-size: 14px;'>
                              Editar
                        </a> 
                        {% endif %}
                  </div>

                  <!--Lista de Empleados-->
                  <section class=" detail-profile w-100 m-1 position-relative ms-4 rounded-5 p-3" 
                        style="background-color: var(--bg-prim);">

                        <!-- Información General -->
                        <h3 class="m-0 p-0 mt-2 pt-1" style='font-weight: bold;'>{{ company.name }}</h3>
                        <p class='text-white-50'>RNC: {{ company.tax_id }}</p>
                        <p class='text-white-50'>Dirección: {{ company.address }}</p>
                        <p class='text-white-50'>Teléfono: {{ company.phone }}</p>

                        <div class='position-absolute bottom-0 p-2 w-100 d-flex justify-content-end start-0'>
                        </div>
                  </section>


            </section>
            {% if request.user.employee_profile.role == 'representante' %}
            <section class='w-100  rounded-5 p-3 mt-3 position-relative' 
                  style='; height: 68%;'>
                  {% if employee %}
                  <strong class='mt-4'>
                        <span class='text-white-50'>({{count}})  Empleados </span>   

                  </strong>
                  <p class="text-white-50">
                        Gestiona los empleados de manera eficiente, activa, descativa, cambia roles y mas
                  </p>
                  <div style="width: 100%; max-height: 9rem; background-color: var(--bg-secdundary);" class="   rounded-4   overflow-auto mb-5"  >
                        {% include "company/employee/list-employee.html" %}
                  </div>
                  {% endif %}

                  {% if company.services.all %}
                        <strong class='mt-5'>
                              <span class='text-white-50'> Servicios contratados <span> 
                        </strong>
                        <p class="text-white-50">
                              Servicios contratados  
                        </p>
                        <div class='mt-3 overflow-auto w-100 d-flex' style=' height: 19rem;'>
                              {% for s in  company.services.all  %}
                      
                               <div data-aos="fade-left"  class="card mb-3 bg-transparent m-2 border-0  " style="width: 420px; transition-delay: 0.{{s.id}}s;">
                                    <div class="row g-0 ">
                                      <div class=" d-flex  w-100 " style='height: 170px;'>
                                          {% if s.img %}
                                          <img src="{{s.img.url}}" class="object-fit-cover  w-100   rounded-5" alt="...">
                                          {% endif %}
                                    </div>
                                      <div class="col-md-8">
                                        <div class="card-body">
                                          <h5 class="card-title text-white  text-capitalize"
                                                style="font-weight: bold;" >   {{s.name}}</h5>
                                          <p class="card-text   overflow-auto text-white-50" style="height: 3.5rem;"> 
                                                {{s.description|truncatechars:25}}...
                                          </p>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                              {% endfor %}
                        </div>
                        <div class="d-none">
                              <strong class='mt-5'>
                                    <span class='text-white-50'> Menus <span> 
                              </strong>
                              <p class="text-white-50">
                                    Establece los menus para el tipo de empleado 
                              </p>
                        </div>
                        <form action="" method="post" id="menuForm" class="d-none">
                              {% csrf_token %}
                              <div class='d-flex w-100 overflow-auto'>
                              {% if menus_choices %}
                                    {% for m in menus_choices %}
                                    <div style='width: 250px;' class='m-1 mt-1'> 
                                                {% if m.menu.img %}
                                                        <img src="{{m.menu.img.url}}" class=' mb-2 mt-2 rounded-circle' style='width: 60px; height: 60px;'  alt="">     
                                                {% endif %}
                                                 {{m.menu.name|truncatechars:'15'}}
                                                <input type="checkbox" name="menus" value="{{m.id}}" {% if m.is_active %} checked {% endif %} class='rounded-circle d-none' style='border-radius: 50% !important;'>
                                                  <select name="role_{{m.id}}" class="form-select border-0 text-white bg-white bg-opacity-10 rounded-3">
                                                            <option value="ejecutivo" {% if m.role == 'ejecutivo' %}selected{% endif %}> Ejecutivo</option>
                                                            <option value="estandar" {% if m.role == 'estandar' %}selected{% endif %}>Estandar</option>
                                                            <option value="representante" {% if m.role == 'representante' %}selected{% endif %}>Representante</option>
                                                  </select>
                                      </div>
                                      
                                      {% endfor %}
                                      <script>
                                                document.addEventListener('DOMContentLoaded', function () {
                                                        const selects = document.querySelectorAll('select[name^="role_"]');
                                                        selects.forEach(select => {
                                                                  select.addEventListener('change', function () {
                                                                          if (this.value === 'representante') {
                                                                                    selects.forEach(s => {
                                                                                            if (s !== this && s.value === 'representante') {
                                                                                                      s.value = 'estandar';
                                                                                            }
                                                                                    });
                                                                          }
                                                                          document.getElementById('menuForm').submit();
                                                                  });
                                                        });
                                                });
                                      </script>
                                    {% endif %}
                              </div>
                         
                        </form>
      
                        {% else %}
                        <div class='mt-5 w-100 text-center'>
                              <strong class='text-white-50 text-center' > No hay servicios contratados <strong/> 
                                    <p  style='font-weight: 400;' class='text-white-50'>
                                          Debe haber un contrato vigente para poder administrar los menus de la semana
                                    </p>
                        </div>
                  {% endif %}
            </section>
            {% else %}

            {% endif %}

<section>



</section>


<div class="dropdown  position-absolute top-0 end-0  mt-5 me-5">
      <button class="btn bg-warning text-black rounded-5 dropdown-toggle"
      style="font-weight: bold;" type="button" data-bs-toggle="dropdown" aria-expanded="false">
            Opciones
      </button>

      <ul class="dropdown-menu " style="background-color: var(--bg-primary); ">
            {% if request.user.employee_profile.role == 'representante' %}
                  <li class="bg-transparent">
                        <a  onclick="LoadMasiveImport()"  class="dropdown-item" >
                              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-cloud-arrow-up-fill" viewBox="0 0 16 16">
                                    <path d="M8 2a5.53 5.53 0 0 0-3.594 1.342c-.766.66-1.321 1.52-1.464 2.383C1.266 6.095 0 7.555 0 9.318 0 11.366 1.708 13 3.781 13h8.906C14.502 13 16 11.57 16 9.773c0-1.636-1.242-2.969-2.834-3.194C12.923 3.999 10.69 2 8 2m2.354 5.146a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708l2-2a.5.5 0 0 1 .708 0z"/>
                              </svg>
                              Carga de empleados masiva
                        </a>
                  </li>
                  <li>
                        <a class="dropdown-item"   
                        href="{% url "company:create-employee"  company.id %}">
                              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-plus-fill" viewBox="0 0 16 16">
                                    <path d="M1 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6"/>
                                    <path fill-rule="evenodd" d="M13.5 5a.5.5 0 0 1 .5.5V7h1.5a.5.5 0 0 1 0 1H14v1.5a.5.5 0 0 1-1 0V8h-1.5a.5.5 0 0 1 0-1H13V5.5a.5.5 0 0 1 .5-.5"/>
                              </svg>
                              Agregar empleado
                        </a>
                  </li>
            {% endif %}
            {% if request.user.restaurant %}
            <li>
                  <a class="dropdown-item"   
                  href="{% url "company:contratos-company" company.id %}">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-earmark-text-fill" viewBox="0 0 16 16">
                        <path d="M9.293 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.707A1 1 0 0 0 13.707 4L10 .293A1 1 0 0 0 9.293 0M9.5 3.5v-2l3 3h-2a1 1 0 0 1-1-1M4.5 9a.5.5 0 0 1 0-1h7a.5.5 0 0 1 0 1zM4 10.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5m.5 2.5a.5.5 0 0 1 0-1h4a.5.5 0 0 1 0 1z"/>
                        </svg>
                        Contratos
                  </a>
            </li>
            {% endif %}
      </ul>
</div>
<div>



<section class="w-100 rounded-5 p-3 mt-3 position-relative" style="background-color: var(--bg-prim);">
      <h4 class="text-white-50">Datos de facturación</h4>
      <table class="table table-striped table-dark">
            <thead>
                  <tr>
                        <th scope="col">Total Facturado</th>
                        <th scope="col">Total Enviado</th>
                        <th scope="col">Total Pendiente</th>
                  </tr>
            </thead>
            <tbody>
                  <tr>
                        <td> ${{ total|intcomma }}</td>
                        <td> ${{ total_entregado|intcomma }}</td>
                        <td> ${{ total_pendiente|intcomma }}</td>
                  </tr>
            </tbody>
      </table>
</section>


</div>
<style>
      .dropdown-menu {
            border-radius: 1rem;
            margin-top: 1rem !important; 
      }
      .dropdown-menu  li a 
      {
            cursor: pointer;
            color: white; font-weight: bold;
            transition: 0.3s  ease-out !important ;

      }
      .dropdown-menu  li a:hover
      {
            background-color: var(--bg-primary) !important;
            color: rgb(255, 208, 0);
      }
</style>
    


{% endblock  %}