{% extends "food/base/base.html" %}
{% block content %}
{% load humanize %}
            <style>
                  .orders {
                        background-color: var(--bg-primary) !important;
                        color:  #857f94 !important;
                        transform: scale(1.1);
                  }
                  .orders  svg   {
                        display: none;
                  }
                   input, select
                  {
                        background-color: var(--bg-primary);
                        border: none; outline: none;
                        padding: 0.6rem; border-radius: 2rem;
                        width: 15rem;
                        color: white;
                  }
                  
            </style>
            <section>

                  <div class="w-100 b">
                              <h5 class="m-0 p-0">   
                                    Ordenes</h5>
                                  <p class="text-white-50 m-0 p-0" style="font-size: 14px;"> Se muestran los listado de los pedidos y su estado actual</p>
                              {% if orders %}
                              {% if  request.user.employee_profile.role == 'representante' %}
                              <table class="w-100 mt-4">
                                    <thead>
                                          <tr>
                                          {% if request.user.employee_profile.role == 'representante' %}
                                          <th style="min-width:10rem ;width: 15%;">Empleado</th>
                                          {% endif %}

                                          <th style="min-width:5rem ;width: 10%;">Imagen</th>
                                          <th style="min-width:10rem ;width: 20%;">Plato</th>
                                          <th style="min-width:10rem ;width: 10%;">Precio</th>
                                          <th style="min-width:10rem ;width: 20%;">Fecha de pedido</th>
                                          <th style="min-width:10rem ;width: 10%;">Hora</th>
                                          <th style="min-width:10rem ;width: 15%;">Estado</th>
                                          </tr>
                                    </thead>
                                
                                    <tbody>
                                          {% for order in orders %}
                                          <tr>
                                                {% if request.user.employee_profile.role == 'representante' %}
                                                <td>{{ order.employee }}</td>
                                                {% endif %}
                                                <td>
                                                      <img src="{{ order.plato.img.url }}" alt="{{ order.plato.name }}" class="rounded-5 mt-2" 
                                                      style="width: 30px; height: 30px;">
                                                </td>
                                                <td>{{ order.name }}</td>
                                                <td> ${{order.price|intcomma}}.00 </td>
                                                <td>{{ order.date|date:"d/m/Y" }}</td>
                                                <td>{{ order.date|date:" H:i" }}</td>
                                                <td >

                                                      {% if order.status == 'preparando' %}
                                                      <span class="badge bg-warning rounded-5"          
                                                      style="color: var(--bg-secundary); font-weight: bold;">  
                                                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-fire" viewBox="0 0 16 16">
                                                            <path d="M8 16c3.314 0 6-2 6-5.5 0-1.5-.5-4-2.5-6 .25 1.5-1.25 2-1.25 2C11 4 9 .5 6 0c.357 2 .5 4-2 6-1.25 1-2 2.729-2 4.5C2 14 4.686 16 8 16m0-1c-1.657 0-3-1-3-2.75 0-.75.25-2 1.25-3C6.125 10 7 10.5 7 10.5c-.375-1.25.5-3.25 2-3.5-.179 1-.25 2 1 3 .625.5 1 1.364 1 2.25C11 14 9.657 15 8 15"/>
                                                          </svg> Preparando
                                                      </span>
                                                      {% elif  order.status == 'enviado' %}
                                                      <span class="badge text-white bg-primary rounded-5"          
                                                      style="; font-weight: bold;">       
                                                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-truck" viewBox="0 0 16 16">
                                                            <path d="M0 3.5A1.5 1.5 0 0 1 1.5 2h9A1.5 1.5 0 0 1 12 3.5V5h1.02a1.5 1.5 0 0 1 1.17.563l1.481 1.85a1.5 1.5 0 0 1 .329.938V10.5a1.5 1.5 0 0 1-1.5 1.5H14a2 2 0 1 1-4 0H5a2 2 0 1 1-3.998-.085A1.5 1.5 0 0 1 0 10.5zm1.294 7.456A2 2 0 0 1 4.732 11h5.536a2 2 0 0 1 .732-.732V3.5a.5.5 0 0 0-.5-.5h-9a.5.5 0 0 0-.5.5v7a.5.5 0 0 0 .294.456M12 10a2 2 0 0 1 1.732 1h.768a.5.5 0 0 0 .5-.5V8.35a.5.5 0 0 0-.11-.312l-1.48-1.85A.5.5 0 0 0 13.02 6H12zm-9 1a1 1 0 1 0 0 2 1 1 0 0 0 0-2m9 0a1 1 0 1 0 0 2 1 1 0 0 0 0-2"/>
                                                          </svg>  En camino
                                                      </span>
                                                      {% elif  order.status == 'pendiente' %}
                                                      <span class="badge text-white bg-danger rounded-5"          
                                                      style="; font-weight: bold;">       
                                                            Pendiente
                                                      </span>
                                                      {% elif  order.status == 'entregado' %}
                                                      <span class="badge text-white bg-success rounded-5"          
                                                      style="; font-weight: bold;">       
                                                            Entregado
                                                      </span>
                                                {% endif %}
                                                      </td>
                                                </tr>
                                          {% endfor %}
                                    </tbody>
                              </table>
                              {% endif %}
                              {% else %}
                              <p class="mt-4">No has realizado pedidos aún</p>
                              {% endif %}
                              {% if not request.user.employee_profile.role == 'representante' %}
                                          <form method="get" class="mb-3 mt-4 w-100" >
                                                <div class="d-flex align-items-center">
                                                      <select name="status" id="status" class="form-select text-white bg-black border-0 p-3 rounded-5 me-2">
                                                            <option value="">Todos</option>
                                                            <option value="preparando" {% if request.GET.status == 'preparando' %}selected{% endif %}>Preparando</option>
                                                            <option value="enviado" {% if request.GET.status == 'enviado' %}selected{% endif %}>En camino</option>
                                                            <option value="pendiente" {% if request.GET.status == 'pendiente' %}selected{% endif %}>Pendiente</option>
                                                            <option value="entregado" {% if request.GET.status == 'entregado' %}selected{% endif %}>Entregado</option>
                                                      </select>
                                                      {% comment %} <button type="submit" class="btn btn-primary">Filtrar</button> {% endcomment %}
                                                </div>
                                          </form>
                                          <div class="row  pb-5 mb-5">
                                                {% for order in orders %}
                                                <div class="col-md-4 mb-2">
                                                      <div class="card bg-black bg-opacity-50 rounded-5  h-100">
                                                            <div class="card-body position-relative">
                                                                  {% if request.user.employee_profile.role == 'representante' %}
                                                                  <h5 class="card-title">{{ order.employee }}</h5>
                                                                  {% endif %}
                                                                  <img src="{{ order.plato.img.url }}" alt="{{ order.plato.name }}" class="card-img-top rounded-circle mt-2 object-fit-cover" style="width: 90px; height: 90px;">
                                                                  <h6 class="card-subtitle   mt-3 text-white">{{ order.name }}</h6>
                                                                  <p class="p-0 m-0 card-text">DOP${{ order.price|intcomma }}.00</p>
                                                                  <p class="p-0 m-0 card-text">{{ order.date|date:"d/m/Y" }} - {{ order.date|date:"h:i" }} </p>
                                                                  <p class="card-text position-absolute top-0 end-0 me-3 mt-3">
                                                                        {% if order.status == 'preparando' %}
                                                                        <span class="badge bg-warning rounded-5" style="color: var(--bg-secundary); font-weight: bold;">
                                                                              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-fire" viewBox="0 0 16 16">
                                                                                    <path d="M8 16c3.314 0 6-2 6-5.5 0-1.5-.5-4-2.5-6 .25 1.5-1.25 2-1.25 2C11 4 9 .5 6 0c.357 2 .5 4-2 6-1.25 1-2 2.729-2 4.5C2 14 4.686 16 8 16m0-1c-1.657 0-3-1-3-2.75 0-.75.25-2 1.25-3C6.125 10 7 10.5 7 10.5c-.375-1.25.5-3.25 2-3.5-.179 1-.25 2 1 3 .625.5 1 1.364 1 2.25C11 14 9.657 15 8 15"/>
                                                                              </svg> Preparando
                                                                        </span>
                                                                        {% elif order.status == 'enviado' %}
                                                                        <span class="badge text-white bg-primary rounded-5" style="font-weight: bold;">
                                                                              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-truck" viewBox="0 0 16 16">
                                                                                    <path d="M0 3.5A1.5 1.5 0 0 1 1.5 2h9A1.5 1.5 0 0 1 12 3.5V5h1.02a1.5 1.5 0 0 1 1.17.563l1.481 1.85a1.5 1.5 0 0 1 .329.938V10.5a1.5 1.5 0 0 1-1.5 1.5H14a2 2 0 1 1-4 0H5a2 2 0 1 1-3.998-.085A1.5 1.5 0 0 1 0 10.5zm1.294 7.456A2 2 0 0 1 4.732 11h5.536a2 2 0 0 1 .732-.732V3.5a.5.5 0 0 0-.5-.5h-9a.5.5 0 0 0-.5.5v7a.5.5 0 0 0 .294.456M12 10a2 2 0 0 1 1.732 1h.768a.5.5 0 0 0 .5-.5V8.35a.5.5 0 0 0-.11-.312l-1.48-1.85A.5.5 0 0 0 13.02 6H12zm-9 1a1 1 0 1 0 0 2 1 1 0 0 0 0-2m9 0a1 1 0 1 0 0 2 1 1 0 0 0 0-2"/>
                                                                              </svg> En camino
                                                                        </span>
                                                                        {% elif order.status == 'pendiente' %}
                                                                        <span class="badge text-white bg-danger rounded-5" style="font-weight: bold;">
                                                                              Pendiente
                                                                        </span>
                                                                        {% elif order.status == 'entregado' %}
                                                                        <span class="badge text-white bg-success rounded-5" style="font-weight: bold;">
                                                                              Entregado
                                                                        </span>
                                                                        {% endif %}
                                                                  </p>
                                                            </div>
                                                      </div>
                                                </div>
                                                {% endfor %}
                                          </div>
                              {% endif %}
                  </div>

                  <div class="d-none">
                        <table class="w-100 mb-2">
                              <thead>
                                    
                                    <th width='25%'>Empleado</th>
                                    <th width='20%'>Plato</th>
                                    <th width='15%'>Pecio</th>
                                    <th width='25%'>Fecha del Pedido</th>
                                    <th width='25%'>Estado de orden</th>
                                    
                              </thead>
                              <tbody>
                                    {% for order in move %}
                                          <tr>
                                                <td>
                                                      {{ order.employee }}
                                                </td>
                                                <td>
                                                      {{ order.name }}
                                                </td>
                                                <td>
                                                      ${{ order.mount|intcomma }}.00
                                                </td>
                                                <td>
                                                      {{ order.date|date:"d/m/Y - H:i" }}
                                                </td>
                                                {% if order.get_status_display == 'Pendiente' %}
                                                      <td class="badge bg-warning rounded-5"          
                                                            style="color: var(--bg-secundary); font-weight: bold;">
                                                            {{ order.get_status_display }}
                                                      </td>
                                                {% else %}
                                                      <td class="badge bg-primary rounded-5">
                                                            Realizadas
                                                      </td>
                                                {% endif %}
                                          </tr>
                                    {% endfor %}      
                              </tbody>
                        </table> 
                  </div>


            </section>
            {% if orders %}
            {% comment %} <a href="{% url 'company:all-orders' %}" class=" text-decoration-none border-0 rounded-5 p-2 ps-4 pe-4 text-white position-absolute bottom-0 end-0 mb-1 " style="font-weight: bold; background-color: var(--bg-secundary); margin-right: 10rem;">
                  Todas las ordenes
            </a> {% endcomment %}
                  <!-- <button class=" border-0 rounded-5 p-2 ps-4 pe-4 text-white position-absolute bottom-0 end-0 mb-1 me-4" style="font-weight: bold; background-color: var(--bg-primary);">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-printer-fill text-white" viewBox="0 0 16 16">
                              <path d="M5 1a2 2 0 0 0-2 2v1h10V3a2 2 0 0 0-2-2zm6 8H5a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1"/>
                              <path d="M0 7a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2h-1v-2a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v2H2a2 2 0 0 1-2-2zm2.5 1a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1"/>
                        </svg> Imprimir 
                  </button> -->
            {% endif %}

            <script>
                  // Selecciona los elementos del formulario
                  const statusSelect = document.getElementById('status');
                  const dateInput = document.getElementById('date');
                  const form = document.querySelector('form');  // El formulario
              
                  // Función para hacer submit del formulario
                  function triggerSubmit() {
                      form.submit();
                  }
              
                  // Agregar evento 'change' a los elementos del formulario
                  statusSelect.addEventListener('change', triggerSubmit);
                  dateInput.addEventListener('change', triggerSubmit);
              </script>
{% endblock  %}