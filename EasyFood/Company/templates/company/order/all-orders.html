{% extends "food/base/base.html" %}
{% block content %}
{% load humanize %}
<style>
      .orders {
            background-color: var(--bg-primary) !important;
            color:  #857f94 !important;
            transform: scale(1.1);
      }
      .orders  svg   {
            display: none;
      }
      form input, select {
            background-color: var(--bg-primary);
            border: none; outline: none;
            padding: 0.6rem; border-radius: 2rem;
            width: 15rem;
            color: white;
      }

      .fade-down {
            opacity: 1;
            transform: translateY(0);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
      }

      .fade-up {
            opacity: 0;
            transform: translateY(-20px);
            transition: opacity 0.6s ease-in, transform 0.6s ease-in;

      }
      @keyframes fadeInDown {
            0% {
                  opacity: 0;
                  transform: translateY(-20px);
            }
            100% {
                  opacity: 1;
                  transform: translateY(0);
            }
      }

      @keyframes fadeOutUp {
            0% {
                  opacity: 1;
                  transform: translateY(0);
            }
            100% {
                  opacity: 0;
                  transform: translateY(-20px);
            }
      }

      .fade-down {
            animation: fadeInDown 0.3s ease-out forwards;
      }

      .fade-up {
            animation: fadeOutUp 0.3s ease-in forwards;
      }

</style>
<section class="w-100">
    

      {% include 'company/order/cp/filter.html' %}

      <div data-aos='fade-down' class=' exito d-none position-absolute top-0 bg-white bg-opacity-10  end-0    text-white p-3  blur-20 '
            style='margin-top: 0rem; width: 100%; transition: 0.6s; border-top-left-radius: 2rem;  border-bottom-left-radius: 2rem; border-top-right-radius: 2rem; border-bottom-right-radius: 2rem; !important'>
            <div  class="alert ">
                  <strong class='text-white' style='font-size:25px;'>
                        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-check-all" viewBox="0 0 16 16">
                              <path d="M8.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L2.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093L8.95 4.992zm-.92 5.14.92.92a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 1 0-1.091-1.028L9.477 9.417l-.485-.486z"/>
                            </svg>  Ordenes entregadas correctamente
                  </strong>
                  <p class='text-white mt-3'> 
                        Las ordenes seleccionadas fueron desplazadas exitosamente al despacho, donde se estaran preparando para su  posterior envio
                  </p>
            </div>
      </div>
      {% if orders_by_company %}
      <div class="w-100">
            {% for company , company_orders in orders_by_company.items %}
            <h2 class='mt-5'> {{ company }}</h2> 
            <table>
                  <thead>
                        <tr>
                              <th style="width: 20%;">Nombre del Plato</th>
                              <th style="width: 15%;">Tipo de menu</th>
                              <th style="width: 15%;">Precio</th>
                              <th style="width: 15%;">Fecha</th>
                              <th style="width: 10%;">Estado</th>
                              <th style="width: 5%;" onclick='toggleAllColors()'>Acciones</th>
                        </tr>
                  </thead>
                  <tbody>
                        {% for order in company_orders %}
                        <tr id='d{{order.id}}'>
                              <td>{{ order.name }}</td>
                              <td>{{ order.category }}</td>
                              <td>${{ order.price|intcomma }}</td>
                              <td>{{ order.date|date:"m-d-Y" }} - {{ order.date|date:"h:i A" }}</td>
                              <td>
                              {% if order.status == 'pendiente' %}
                                    <span class="badge bg-danger  text-white rounded-5"          
                                    style=" font-weight: bold;">  
                                          Pendiente
                                    </span>
                                    {% elif  order.status == 'enviado' %}
                                    <span class="badge text-white bg-primary rounded-5"          
                                    style="; font-weight: bold;">       
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-truck" viewBox="0 0 16 16">
                                          <path d="M0 3.5A1.5 1.5 0 0 1 1.5 2h9A1.5 1.5 0 0 1 12 3.5V5h1.02a1.5 1.5 0 0 1 1.17.563l1.481 1.85a1.5 1.5 0 0 1 .329.938V10.5a1.5 1.5 0 0 1-1.5 1.5H14a2 2 0 1 1-4 0H5a2 2 0 1 1-3.998-.085A1.5 1.5 0 0 1 0 10.5zm1.294 7.456A2 2 0 0 1 4.732 11h5.536a2 2 0 0 1 .732-.732V3.5a.5.5 0 0 0-.5-.5h-9a.5.5 0 0 0-.5.5v7a.5.5 0 0 0 .294.456M12 10a2 2 0 0 1 1.732 1h.768a.5.5 0 0 0 .5-.5V8.35a.5.5 0 0 0-.11-.312l-1.48-1.85A.5.5 0 0 0 13.02 6H12zm-9 1a1 1 0 1 0 0 2 1 1 0 0 0 0-2m9 0a1 1 0 1 0 0 2 1 1 0 0 0 0-2"/>
                                        </svg>  En camino
                                    </span>
                              {% endif %}
                              </td>
                              <td>
                                    {% if order.status == 'pendiente' %}
                                    <button data-id="{{order.id}}" class="badge  border-0 text-white {% if order.status != 'enviado' %}select{% endif %} bg-black rounded-5" style="font-weight: bold;" onclick="toggleColor(this)">
                                          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-all" viewBox="0 0 16 16">
                                                <path d="M8.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L2.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093L8.95 4.992zm-.92 5.14.92.92a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 1 0-1.091-1.028L9.477 9.417l-.485-.486z"/>
                                              </svg>
                                    </button>
                                    {% endif %}
                                           
                                    <script>
                                          function toggleColor(element) {
                                                if (element.classList.contains('bg-black')) {
                                                      element.classList.remove('bg-black');
                                                      element.classList.add('bg-primary');
                                                      count++;
                                                } else {
                                                      element.classList.remove('bg-primary');
                                                      element.classList.add('bg-black');
                                                }

                                                const buttons = document.querySelectorAll('.select.bg-primary');
                                                document.querySelector('.count-select').textContent = `(${buttons.length})`;

                                                if (buttons.length > 0) {
                                                              sendButton.classList.remove('d-none');
                                                } else {
                                                              sendButton.classList.add('d-none');
                                                }
                                          }
                                    </script>
                              </td>
                        </tr>
                        {% endfor %}
                  </tbody>
            </table>
            {% endfor %}
      </div>
      {% else %}
                  <div class="text-center vh-100 d-flex align-content-center flex-wrap justify-content-center pb-5 " >
                  
                        <h5 class='w-100'>
                              <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-list-task" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M2 2.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5V3a.5.5 0 0 0-.5-.5zM3 3H2v1h1z"/>
                                    <path d="M5 3.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5M5.5 7a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1zm0 4a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1z"/>
                                    <path fill-rule="evenodd" d="M1.5 7a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5H2a.5.5 0 0 1-.5-.5zM2 7h1v1H2zm0 3.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zm1 .5H2v1h1z"/>
                                  </svg>   No hay Ã³rdenes registradas
                        </h5>
                         <p class='text-white-50'> 
                              Aqui se mostraran las ordenes que los clientes que han realizado una orden en tu empresa
                         </p>
                  </div>
      {% endif %}
</section>

<script>
      let count = 0;    
      const sendButton = document.querySelector('.send-button');
      function toggleAllColors() {
            const buttons = document.querySelectorAll('.select');
            buttons.forEach(button => {
                          if (button.classList.contains('bg-black')) {
                                    button.classList.remove('bg-black');
                                    button.classList.add('bg-primary');
                                    count++;
                          } else {
                                    button.classList.remove('bg-primary');
                                    button.classList.add('bg-black');
                          }
                  });
                  document.querySelector('.count-select').textContent = `(${count})`;
                  
               
                  if (count > 0) {
                        sendButton.disabled = false;
                        sendButton.classList.add('bg-primary');
                        sendButton.classList.remove('bg-white', 'bg-opacity-10');
                  } else {
                        sendButton.disabled = true;
                        sendButton.classList.remove('bg-primary' );
                        sendButton.classList.add('bg-white', 'bg-opacity-10');

                    }
            count = 0;
        }
      function getSelectedIds() {
            const selectedButtons = document.querySelectorAll('.select.bg-primary');
            const selectedIds = Array.from(selectedButtons).map(button => button.getAttribute('data-id'));
            return selectedIds;
      }
      function sendSelectedIds() {
            const selectedButtons = document.querySelectorAll('.select.bg-primary');
            const selectedIds = Array.from(selectedButtons).map(button => {
                  document.querySelector('#d'+button.getAttribute('data-id')).remove();
                  return button.getAttribute('data-id');
            });

            const url = window.location.href;
            $.ajax({
                  type: 'POST',
                  url: url,
                  data: {
                        ids: selectedIds,
                        csrfmiddlewaretoken: '{{ csrf_token }}'
                  },
                  success: function(data) {
                        console.log('Success:', data);
                        showSuccessMessage()
                        sendButton.disabled = true;


                  },
                  error: function(error) {
                        console.error('Error:', error);
                  }
            });
      }

      function showSuccessMessage() {
            const successMessage = document.querySelector('.exito');
            successMessage.classList.remove('d-none');
            successMessage.classList.remove('fade-up');
            successMessage.classList.add('fade-down');

            setTimeout(function() {
                  successMessage.classList.add('fade-up');
                  successMessage.classList.remove('fade-down');
                  sendButton.classList.remove('bg-primary' );
                  sendButton.classList.add('bg-white', 'bg-opacity-10');
                  setTimeout(function() {
                        successMessage.classList.add('d-none');
            
                  }, 600);
            }, 1500);
      }
</script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
{% endblock %}